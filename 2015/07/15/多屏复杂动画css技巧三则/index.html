<!-- build time:Wed Jun 27 2018 23:48:08 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="baidu-site-verification" content="TIRp90R4UV"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css"><meta name="keywords" content="多屏复杂动画,"><link rel="shortcut icon" type="image/x-icon" href="/uploads/favicon.ico?v=5.1.2"><meta name="description" content="&amp;emsp;&amp;emsp;当下CSS3应用已经相当广泛，其中重要成员之一就是CSS3动画。并且，随着CSS动画的逐渐深入与普及，更复杂与细腻的动画场景也如雨后春笋般破土而出。例如「企业QQ-新年祝福」活动：&amp;emsp;&amp;emsp;感谢shirley帮忙录制上面的视频，虽然视频内容是手机上的显示效果，但是，这个“企业新年祝福活动”原本只针对桌面端，移动端是后来辅助增强（增加了相当于活动页面UV 5.7"><meta name="keywords" content="多屏复杂动画"><meta property="og:type" content="article"><meta property="og:title" content="多屏复杂动画CSS技巧三则"><meta property="og:url" content="http://www.npm8.com/2015/07/15/多屏复杂动画css技巧三则/index.html"><meta property="og:site_name" content="BaoSheng"><meta property="og:description" content="&amp;emsp;&amp;emsp;当下CSS3应用已经相当广泛，其中重要成员之一就是CSS3动画。并且，随着CSS动画的逐渐深入与普及，更复杂与细腻的动画场景也如雨后春笋般破土而出。例如「企业QQ-新年祝福」活动：&amp;emsp;&amp;emsp;感谢shirley帮忙录制上面的视频，虽然视频内容是手机上的显示效果，但是，这个“企业新年祝福活动”原本只针对桌面端，移动端是后来辅助增强（增加了相当于活动页面UV 5.7"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="http://www.npm8.com/wp-content/uploads/2015/07/15.png"><meta property="og:image" content="http://www.npm8.com/wp-content/uploads/2015/07/dd1.jpg"><meta property="og:image" content="http://www.npm8.com/wp-content/uploads/2015/07/21.gif"><meta property="og:image" content="http://isux.tencent.com/wp-content/uploads/2015/03/20150309180730154.png"><meta property="og:image" content="http://mat1.gtimg.com/www/mb/images/face/32.gif"><meta property="og:image" content="http://www.npm8.com/wp-content/uploads/2015/07/31.png"><meta property="og:image" content="http://www.npm8.com/wp-content/uploads/2015/07/42.png"><meta property="og:image" content="http://www.npm8.com/wp-content/uploads/2015/07/51.png"><meta property="og:image" content="http://mat1.gtimg.com/www/mb/images/face/1.gif"><meta property="og:image" content="http://www.npm8.com/wp-content/uploads/2015/07/6png.png"><meta property="og:image" content="http://www.npm8.com/wp-content/uploads/2015/07/71.png"><meta property="og:image" content="http://www.npm8.com/wp-content/uploads/2015/07/81.png"><meta property="og:image" content="http://www.npm8.com/wp-content/uploads/2015/07/9.png"><meta property="og:image" content="http://www.npm8.com/wp-content/uploads/2015/07/10.png"><meta property="og:image" content="http://www.npm8.com/wp-content/uploads/2015/07/111.png"><meta property="og:image" content="http://mat1.gtimg.com/www/mb/images/face/14.gif"><meta property="og:image" content="http://www.npm8.com/wp-content/uploads/2015/07/121.png"><meta property="og:updated_time" content="2018-06-14T07:47:52.540Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="多屏复杂动画CSS技巧三则"><meta name="twitter:description" content="&amp;emsp;&amp;emsp;当下CSS3应用已经相当广泛，其中重要成员之一就是CSS3动画。并且，随着CSS动画的逐渐深入与普及，更复杂与细腻的动画场景也如雨后春笋般破土而出。例如「企业QQ-新年祝福」活动：&amp;emsp;&amp;emsp;感谢shirley帮忙录制上面的视频，虽然视频内容是手机上的显示效果，但是，这个“企业新年祝福活动”原本只针对桌面端，移动端是后来辅助增强（增加了相当于活动页面UV 5.7"><meta name="twitter:image" content="http://www.npm8.com/wp-content/uploads/2015/07/15.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",sidebar:{position:"left",display:"post",offset:12,offset_float:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!0,tabs:!0,motion:!0,duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://www.npm8.com/2015/07/15/多屏复杂动画css技巧三则/"><title>多屏复杂动画CSS技巧三则 | BaoSheng</title><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?‘6c005185d8aabb2ec10cf577df122aa7’";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">BaoSheng</span> <span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">Rome was not built in a day.</h1></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://www.npm8.com/2015/07/15/多屏复杂动画css技巧三则/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="baosheng"><meta itemprop="description" content=""><meta itemprop="image" content="/uploads/avatar.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="BaoSheng"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">多屏复杂动画CSS技巧三则</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-07-15T13:08:36+08:00">2015-07-15 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/HTML5-CSS3/" itemprop="url" rel="index"><span itemprop="name">HTML5/CSS3</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><p><a href="http://www.npm8.com/wp-content/uploads/2015/07/15.png"><img src="http://www.npm8.com/wp-content/uploads/2015/07/15.png" alt="1"></a></p><p>&emsp;&emsp;当下CSS3应用已经相当广泛，其中重要成员之一就是CSS3动画。并且，随着CSS动画的逐渐深入与普及，更复杂与细腻的动画场景也如雨后春笋般破土而出。例如「企业QQ-新年祝福」活动：</p><p><a href="http://www.npm8.com/wp-content/uploads/2015/07/dd1.jpg"><img src="http://www.npm8.com/wp-content/uploads/2015/07/dd1.jpg" alt="dd"></a></p><p>&emsp;&emsp;感谢shirley帮忙录制上面的视频，虽然视频内容是手机上的显示效果，但是，这个“企业新年祝福活动”原本只针对桌面端，移动端是后来辅助增强（增加了相当于活动页面UV 5.7%的点击）。而目前大多数类似页面只针对移动端，例如其他同事实现的QQ空间5.0预约页第二版：</p><p><a href="http://www.npm8.com/wp-content/uploads/2015/07/21.gif"><img src="http://www.npm8.com/wp-content/uploads/2015/07/21.gif" alt="2"></a></p><p>扫码(需登录)或者链接二选一：</p><p><a href="http://isux.tencent.com/wp-content/uploads/2015/03/20150309180730154.png" target="_blank" rel="external"><img src="http://isux.tencent.com/wp-content/uploads/2015/03/20150309180730154.png" alt="经验分享：多屏复杂动画CSS技巧三则"></a></p><p><a href="http://qzs.qq.com/qzone/qzact/act/qzapp/qzone5.0/mobile/index.html" target="_blank" rel="external">访问demo戳这里</a></p><p>&emsp;&emsp;因此，需要多一点适配的技巧。但是，对于动画效果实现，其实都是一脉相承的，最终的实现需要很多点滴积累，我这里讲三个部分同学可能不知道的相关CSS技巧。</p><p>注：示例代码的私有前缀均省略，大家自行脑补</p><h2 id="技巧一、使用animation-play-state控制每屏动画播放"><a href="#技巧一、使用animation-play-state控制每屏动画播放" class="headerlink" title="技巧一、使用animation-play-state控制每屏动画播放"></a>技巧一、使用animation-play-state控制每屏动画播放</h2><p><strong>1. 类名active与动画触发</strong></p><p>首先，使用<code>active</code>触发每一屏的动画，几乎已经约定俗成，应该也建议成为默认的行业规范。</p><p>一般做法是，当对应一屏内容进入的时候，使用JS给容器添加类名<code>active</code>:<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">如果你做的动画逼格较高，希望每次浏览这一屏内容的时候，动画都走一遍，可以使用reflow重新触发一下`animation`:</div><div class="line">```javascript</div><div class="line">container.classList.remove(&quot;active&quot;);</div><div class="line">container.offsetWidth = container.offsetWidth;</div><div class="line">container.classList.add(&quot;active&quot;);</div></pre></td></tr></table></figure><p></p><p><strong>2. 类名active与动画控制技巧</strong></p><p>&emsp;&emsp;如何具体控制动画的播放呢？我们通常第一反应是使用下面的方法实现，动画的完整CSS代码在active状态下呈现，如：<br></p><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.element1</span> &#123; <span class="comment">/* 尺寸与定位 */</span> &#125;</div><div class="line"><span class="selector-class">.element2</span> &#123; <span class="comment">/* 尺寸与定位 */</span> &#125;</div><div class="line"><span class="selector-class">.element3</span> &#123; <span class="comment">/* 尺寸与定位 */</span> &#125;</div><div class="line">...</div><div class="line"></div><div class="line"><span class="selector-class">.active</span> <span class="selector-class">.element1</span> &#123; <span class="attribute">animate</span>: name1 <span class="number">1s</span>; &#125;</div><div class="line"><span class="selector-class">.active</span> <span class="selector-class">.element2</span> &#123; <span class="attribute">animate</span>: name2 <span class="number">1s</span>; &#125;</div><div class="line"><span class="selector-class">.active</span> <span class="selector-class">.element3</span> &#123; <span class="attribute">animate</span>: name2 <span class="number">1s</span>; &#125;</div><div class="line">...</div></pre></td></tr></table></figure><p></p><p>&emsp;&emsp;从实现和功能上将，上面方法是很不错的，通俗易懂，不易犯错。不过我个人更喜欢使用配合CSS3的<code>animation-play-state</code>属性对每屏动画进行控制，实现如下：</p><ol><li><p>动画相关CSS代码直接写在元素上：</p><figure class="highlight plain"><figcaption><span>&#123;</span><a href="/*">尺寸与定位 */ animate: name1 1s; &#125;</a></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">.element2 &#123; /* 尺寸与定位 */ animate: name2 1s; &#125;</div><div class="line">.element3 &#123; /* 尺寸与定位 */ animate: name3 1s; &#125;</div><div class="line">...</div></pre></td></tr></table></figure></li><li><p>创建一个类名，如<code>.animate</code>，凡是使用到了<code>animation</code>动画的元素都添加这个类名；</p></li><li>如下CSS代码：<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.animate</span> &#123;</div><div class="line">    <span class="attribute">animation-play-state</span>: paused;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.active</span> <span class="selector-class">.animate</span> &#123;</div><div class="line">    <span class="attribute">animation-play-state</span>: running;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ol><p>之所以个人更喜欢后面的方法，是因为有一种“无侵入”的感觉，代码层次清晰，控制关系明确。有利于后期的维护与扩展。</p><p>然而，使用<code>animation-play-state</code>还是有些需要注意的，对于IE10/IE11浏览器，<code>animation-play-state</code>是不能简写的。如：<br></p><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.element</span> &#123; <span class="attribute">animate</span>: shake <span class="number">4s</span> <span class="number">2s</span> both infinite paused; &#125;</div></pre></td></tr></table></figure><p></p><p>只会让整个CSS声明挂掉的！如下写法支持：<br></p><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.element</span> &#123;</div><div class="line">    <span class="attribute">animate</span>: shake <span class="number">4s</span> <span class="number">2s</span> both infinite;</div><div class="line">    <span class="attribute">animation-play-state</span>: paused;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p><p>有人可能要奇怪了，怎么突然IE浏览器乱入了？ <img src="http://mat1.gtimg.com/www/mb/images/face/32.gif" alt="经验分享：多屏复杂动画CSS技巧三则"></p><p>首先，我们不能无视主流手机之Windows Phone. 其次，帅气的翻屏动画并不是移动端专有，桌面端也适用。稍稍用力，桌面移动全适配，何乐而不为！</p><h2 id="技巧二、不同状态下的连续动画"><a href="#技巧二、不同状态下的连续动画" class="headerlink" title="技巧二、不同状态下的连续动画"></a>技巧二、不同状态下的连续动画</h2><p>有时候，动画可能不是一波流，分状态。</p><p>例如，我们的小火箭，先是淡出动画，然后无限上下悬浮。怎么实现呢？</p><p><a href="http://www.npm8.com/wp-content/uploads/2015/07/31.png"><img src="http://www.npm8.com/wp-content/uploads/2015/07/31.png" alt="3"></a></p><p>关键点就是动画分解与延时。</p><p>&emsp;&emsp;据我所知，没办法只使用一个<code>keyframes</code>关键帧声明就实现这个效果，因为，这里有动画状态的变化：一个只执行一次的动画和一个无限循环动画。</p><p>怎么办？我们可以将动画分解，写2个<code>animation</code> <code>keyframes</code>动画关键帧描述。<br></p><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">keyframes</span> fadeIn &#123; <span class="comment">/* ... */</span> &#125;</div><div class="line">@<span class="keyword">keyframes</span> float &#123; <span class="comment">/* ... */</span> &#125;</div></pre></td></tr></table></figure><p></p><p>然后，再分别应用这些关键帧动画。如何应用呢？有2个小技巧：</p><p><strong>1. 逗号与多animation动画值</strong></p><p>如下：<br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"element"</span>&gt;</span>小火箭<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line">.element &#123; animation: fadeIn 1s, float .5s 1s infinite; &#125;</div><div class="line">/* 我淡出, 需要1秒；我1秒后开始无限漂浮 */</div></pre></td></tr></table></figure><p></p><p>&emsp;&emsp;其中<code>float .5s 1s infinite</code>这里的<code>1s</code>就是无限漂浮动画执行延迟的时间，于是，两个动画完美配合，感觉就像是一个动画。实际上，就是一个动画，所有CSS3 animation动画走同一个UI线程，这也是为何推荐使用CSS实现动画效果的原因。</p><p>此写法没有兼容性问题，大家可以开开心心地使用。</p><p><strong>2. 标签嵌套与独立动画</strong></p><p>我们还可以通过嵌套标签的形式实现连续动画，例如：<br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"element-wrap"</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"element"</span>&gt;</span>小火箭<span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line">.element-wrap &#123; animation: fadeIn 1s; &#125;</div><div class="line">/* 我淡出, 需要1秒 */</div><div class="line">.element &#123; animation: float .5s 1s infinite; &#125;</div><div class="line">/* 我1秒后开始无限漂浮 */</div></pre></td></tr></table></figure><p></p><p>&emsp;&emsp;有人可能会奇怪了。<code>animation</code>本身就支持多动画并行，你还搞个标签嵌套，没有任何使用的理由啊！没错，单纯看我们这个例子，确实是这样。但是：</p><p><strong>① 提取公用动画</strong></p><p>&emsp;&emsp;这类多屏动画是有N多元素同时执行不同的动画。比方说，火箭是淡出，然后上下漂浮；火箭的火焰是淡出，然后大小变化；黑洞是淡出，然后左右随波。你如何实现？</p><p>如果纯粹借助<code>animation</code>语法，应该是：<br></p><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.element1</span> &#123; <span class="attribute">animation</span>: fadeIn <span class="number">1s</span>, float .<span class="number">5s</span> <span class="number">1s</span> infinite; &#125;</div><div class="line"><span class="comment">/* 我淡出, 需要1秒；我1秒后开始无限漂浮 */</span></div><div class="line"><span class="selector-class">.element2</span> &#123; <span class="attribute">animation</span>: fadeIn <span class="number">1s</span>, size .<span class="number">5s</span> <span class="number">1s</span> infinite; &#125;</div><div class="line"><span class="comment">/* 我淡出, 需要1秒；我1秒后开始大小变化 */</span></div><div class="line"><span class="selector-class">.element3</span> &#123; <span class="attribute">animation</span>: fadeIn <span class="number">1s</span>, move .<span class="number">5s</span> <span class="number">1s</span> infinite; &#125;</div><div class="line"><span class="comment">/* 我淡出, 需要1秒；我1秒后开始左右移动 */</span></div></pre></td></tr></table></figure><p></p><p>可以看到，淡出是公用的动画效果，我们可以借助嵌套标签，实现公用语法的合并，方面后期维护：<br></p><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.element-wrap</span> &#123; <span class="attribute">animation</span>: fadeIn <span class="number">1s</span>; &#125;</div><div class="line"><span class="comment">/* 大家都1秒淡出 */</span></div><div class="line"><span class="selector-class">.element1</span> &#123; <span class="attribute">animation</span>: float .<span class="number">5s</span> <span class="number">1s</span> infinite; &#125;</div><div class="line"><span class="comment">/* 我1秒后无限漂浮 */</span></div><div class="line"><span class="selector-class">.element2</span> &#123; <span class="attribute">animation</span>: size .<span class="number">5s</span> <span class="number">1s</span> infinite; &#125;</div><div class="line"><span class="comment">/* 我1秒后忽大忽小 */</span></div><div class="line"><span class="selector-class">.element3</span> &#123; <span class="attribute">animation</span>: move .<span class="number">5s</span> <span class="number">1s</span> infinite; &#125;</div><div class="line"><span class="comment">/* 我1秒后左右移动 */</span></div></pre></td></tr></table></figure><p></p><p><strong>②避免变换冲突</strong></p><p>&emsp;&emsp;有个元素动画是边360度旋转、边放大(从0放大到100%)，像这种具有典型特征的动画我们显然要独立提取与公用的：<br></p><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">keyframes</span> spin &#123; <span class="comment">/* transform: rotate... */</span> &#125;</div><div class="line">@<span class="keyword">keyframes</span> zoomIn &#123; <span class="comment">/* transform: scale... */</span> &#125;</div></pre></td></tr></table></figure><p></p><p>好了，现在问题来了，变放大边旋转：<br></p><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.element</span> &#123; <span class="attribute">animation</span>: spin <span class="number">1s</span>, zoomIn <span class="number">1s</span>; &#125;</div><div class="line"><span class="comment">/* 旋转：啊，完蛋啦，我被放大覆盖啦！ */</span></div></pre></td></tr></table></figure><p></p><p>&emsp;&emsp;由于都是使用transform, 发生了残忍的覆盖。当然，有好事的人会说，你使用<code>zoom</code>不就好了！确实，如果只是移动端，使用<code>zoom</code>确实棒棒哒！但是，我们这个企业活动，PC是主战场，因此，FireFox浏览器（FF不识zoom）是不能无视的。</p><p>怎么办？重新建一个名为<code>spinZoomIn</code>的动画关键帧描述还是？</p><p>对啊，你直接外面套一层标签不就万事大吉了<br></p><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.element-wrap</span> &#123; <span class="attribute">animation</span>: spin <span class="number">1s</span>; &#125;   <span class="comment">/* 我转转转 */</span></div><div class="line"><span class="selector-class">.element</span> &#123; <span class="attribute">animation</span>: zoomIn <span class="number">1s</span>; &#125;      <span class="comment">/* 我大大大 */</span></div></pre></td></tr></table></figure><p></p><h2 id="技巧三、无侵入定位和居中定位准则"><a href="#技巧三、无侵入定位和居中定位准则" class="headerlink" title="技巧三、无侵入定位和居中定位准则"></a>技巧三、无侵入定位和居中定位准则</h2><p>1. 这里的“<strong>无侵入定位</strong>”指不受<code>animation</code>影响的元素定位，包含两部分：一是不使用<code>keyframes</code>关键帧决定初始位置；二是不要使用<code>keyframes</code>中出现的属性定位。</p><p><strong>①. 不使用<code>keyframes</code>决定初始位置</strong></p><p>&emsp;&emsp;应该都知道，CSS3 <code>animation</code>的<code>fill-mode</code>可以决定元素动画结束前后的位置，也就是也具有定位的作用。此时，可能就会有小伙伴，故作聪明，利用<code>animation</code> <code>keyframes</code> <code>0% {}</code>或<code>form {}</code>去做定位，貌似，还省了写代码。看上去很赞，实际上狭隘了，这对于对<code>animation</code>支持不佳或不支持的浏览器实际上是不友好的，例如Android2.3不支持<code>animation-fill-mode</code>, IE6-IE9不支持CSS3 <code>animation</code>，于是乎，当遭遇这些浏览器的时候，页面动画元素的布局实际上是毁掉的。所以，这些动画元素定位的时候，需要使用“无侵入定位”，也就是，就算页面没有<code>animation</code>, 我也是个“标致人儿”。</p><p><strong>②. 不使用<code>keyframes</code>中出现的属性定位</strong></p><p>&emsp;&emsp;举个例子，有个球，正好定位在模块的中心，同时有个无限旋转效果。使用<code>transform: translate(-50%,-50%)</code>居中定位再合适不过了，不用我心里难受，于是，使用了<code>transform</code>定位。此时，冲突发生，旋转动画也是需要<code>transform</code>变换的。<br></p><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">keyframes</span> spin &#123;</div><div class="line">    0% &#123; <span class="attribute">transform</span>: <span class="built_in">rotate</span>(0); &#125;</div><div class="line">    100% &#123; <span class="attribute">transform</span>: <span class="built_in">rotate</span>(360deg); &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p><p>要么使用业界约定俗成<code>spin</code>覆盖，要么另起炉灶没法重用：<br></p><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">keyframes</span> spin-trans &#123;</div><div class="line">    0% &#123; <span class="attribute">transform</span>: <span class="built_in">rotate</span>(0) <span class="built_in">translate</span>(-50%,-50%); &#125;</div><div class="line">    100% &#123; <span class="attribute">transform</span>: <span class="built_in">rotate</span>(360deg) <span class="built_in">translate</span>(-50%,-50%); &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p><p>显然，都是不合适的。建议使用传统<code>left/top/margin</code>进行定位，与<code>transform</code>变换动画“无侵入”。</p><p>2. 这里的“<strong>居中定位准则</strong>”包含两部分：一是元素定位在容器中间位置；二是元素的定位方式为居中定位。</p><p><strong>①. 元素定位在容器中间</strong><br>容器以及容器内的动画元素可以看成是一个动画模块，为了这个模块可以轻松驾驭水平布局和垂直局部，里面的动画元素形成的整体一定要在容器的中间，不要被设计稿或周围环境影响。</p><p>举个简单例子，本文一开始展示的「企业QQ-新年祝福」活动。</p><p>&emsp;&emsp;企业产品用户特点比较鲜明：一是访问主要集中在桌面端，二是有70~80%用户使用的是webkit/blink内核浏览器。所以，大家可以理解为何设计稿明明针对桌面端，却有如此多细腻的动画设计了。</p><p>&emsp;&emsp;故事是这样的，桌面版做好了，1024-1224自适应，IE7以上都兼容（无侵入定位准则）（除了没动画），好棒!此时负责视觉的晓玲同学希望也能适配移动端，可以增加一定的传播，我觉得挺好的，于是，决定通过技术手段，让活动页面能游走于桌面和移动之间，同时，保证各种动画效果棒棒哒！</p><p>&emsp;&emsp;结果，发现自己留了一个坑，拿第2屏举例，桌面版，长这样，右侧动画内容并不是完全居中的：</p><p><a href="http://www.npm8.com/wp-content/uploads/2015/07/42.png"><img src="http://www.npm8.com/wp-content/uploads/2015/07/42.png" alt="4"></a></p><p>本着高度还原设计稿的原则，所有动画元素都经过测量定位，按照PSD中的参考线左上角(left/top)，结果整体左侧冒出60像素：</p><p><a href="http://www.npm8.com/wp-content/uploads/2015/07/51.png"><img src="http://www.npm8.com/wp-content/uploads/2015/07/51.png" alt="5"></a></p><p>&emsp;&emsp;于是，问题来了，当移动端做响应式适配时候，由于容器内的动画元素不是居中的，所以——<img src="http://mat1.gtimg.com/www/mb/images/face/1.gif" alt="经验分享：多屏复杂动画CSS技巧三则"></p><p><a href="http://www.npm8.com/wp-content/uploads/2015/07/6png.png"><img src="http://www.npm8.com/wp-content/uploads/2015/07/6png.png" alt="6png"></a></p><p>&emsp;后来，进行了修改，内部动画元素整体居中，外部容器桌面端做左侧60像素偏移，于是，适配移动端时候，就正好是居中的啦。</p><p><a href="http://www.npm8.com/wp-content/uploads/2015/07/71.png"><img src="http://www.npm8.com/wp-content/uploads/2015/07/71.png" alt="7"></a></p><p><strong>②. 定位方式为居中定位</strong><br>所谓“居中定位”是相对“传统定位”而言的。Web页面中的模块、文字什么的默认都是相对于左上角堆砌的，所以，很自然地，我们在重构页面，做布局，写交互效果的时候，也都是相对左上角定位。活用元素本身的定位特性，这是很赞的也推荐这么做！但是，如果你和多元素CSS动画打交道，可能就需要改变下惯性思维了，很重要的一点就是“<strong>从以左上角为参考点变成以中心点为参考点</strong>”。</p><p><a href="http://www.npm8.com/wp-content/uploads/2015/07/81.png"><img src="http://www.npm8.com/wp-content/uploads/2015/07/81.png" alt="8"></a><a href="http://www.npm8.com/wp-content/uploads/2015/07/9.png"><img src="http://www.npm8.com/wp-content/uploads/2015/07/9.png" alt="9"></a></p><p>&emsp;&emsp;我们在实现多元素动画效果时候，会出现两类角色：一是容器；二是容器里面诸多动画元素。</p><p>其中，对于容器元素，尤其在做移动端产品时候，我们很自然会让其居中定位：<br></p><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.container</span> &#123;</div><div class="line">    <span class="attribute">position</span>: absolute; <span class="attribute">left</span>: <span class="number">50%</span>; <span class="attribute">top</span>: <span class="number">50%</span>;</div><div class="line">    <span class="attribute">transform</span>: <span class="built_in">translate3d</span>(-50%, -50%, 0);</div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p><p>这样，各种尺寸的手机，我们都能让其居中显示（大尺寸可能需要一定的缩放）。</p><p>但是，我们有没有想过让容器里面的诸多动画元素也居中定位显示呢？</p><p>用代码来解释就是从左上角定位（或右上角定位）：<br></p><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.example</span> &#123;</div><div class="line">    <span class="attribute">position</span>: absolute; <span class="attribute">left</span>: <span class="number">100px</span>; <span class="attribute">top</span>: <span class="number">100px</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p><p>变成中心点定位+ <code>margin</code>偏移：<br></p><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.example</span> &#123;</div><div class="line">    <span class="attribute">position</span>: absolute; <span class="attribute">left</span>: <span class="number">50%</span>; <span class="attribute">top</span>: <span class="number">50%</span>;</div><div class="line">    <span class="attribute">margin-left</span>: -<span class="number">100px</span>; <span class="attribute">margin-top</span>: -<span class="number">100px</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p><p>有同学可能要疑问了，why? 前面一步到位不挺好的，后面这样分两步走岂不是多余？</p><p>&emsp;在大多数情况下，我们的应用场景比较单一，或只需要玩转移动端，或只需要驾驭桌面端，此时，上面两种定位的优劣是看不出来的。</p><p>但是，遇到一些复杂的应用场景，尤其涉及到容器尺寸或定位方式改变的时候，后面的定位优势就可以看出来。</p><p>比方说一开始提到的qzone5.0的例子，如果我们把容器宽度加大（实际是不会的，示意目的），如<code>414</code>像素：</p><p><a href="http://www.npm8.com/wp-content/uploads/2015/07/10.png"><img src="http://www.npm8.com/wp-content/uploads/2015/07/10.png" alt="10"></a></p><p>会发现，宇航员和飞船在小行星之外了，也就是动画元素不是聚拢状态了。</p><p>所以，大家看出居中定位的优势来了没有：</p><ol><li>动画元素之间的位置关系不受容器尺寸影响；</li><li>居中特性遭遇多场景时适应性更强；<br>还是拿去年年底做的「企业QQ-新年祝福」活动举例，第8屏：</li></ol><p><a href="http://www.npm8.com/wp-content/uploads/2015/07/111.png"><img src="http://www.npm8.com/wp-content/uploads/2015/07/111.png" alt="11"></a></p><p>&emsp;&emsp;其中，中间的“王强”和“马老板”这些数据有可能是没有的，也就是很有可能这一屏只有文字和宇航员，但同时还要保持整体垂直居中。很显然，宇航员和火箭所在的容器不能是绝对定位，否则脱离文档流，不能和上面元素保持合适垂直间距同时垂直居中。我们仍然有2种实现方法：</p><ol><li>固定容器宽度，例如<code>350</code>像素宽，然后，里面左上角定位等，本身<code>margin: auto</code>水平居中；</li><li><p>容器不设定<code>width</code>大小，直接里面动画元素居中定位；<br>方法1问题在于：</p></li><li><p>第7屏是类似结构，但是其动画容器宽度不是<code>350</code>像素，没法重用；</p></li><li>当在iPhone5/iPhone5s下，屏幕<code>320</code>像素宽(小于<code>350</code>像素)，由于左上角定位，因此，整体不是居中效果；<br>而方法2，屏幕尺寸再小，也是居中的，只不过两侧有所剪裁。最终，移动端适配时候，我们不必关心定位问题，只要合适缩放就可以了 <img src="http://mat1.gtimg.com/www/mb/images/face/14.gif" alt="经验分享：多屏复杂动画CSS技巧三则">：</li></ol><p><a href="http://www.npm8.com/wp-content/uploads/2015/07/121.png"><img src="http://www.npm8.com/wp-content/uploads/2015/07/121.png" alt="12"></a></p><p><a href="http://demo.grycheng.com/case/new-opp/" target="_blank" rel="external">以上两屏示意demo戳这里</a></p><h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>&emsp;&emsp;首先，大家要明白，本文所展示的三个技术技巧属于个人经验建议，注意，是建议。里面所提到的所有解决方法都有更加直观、通俗的实现，对于大多数的产品而言，技术的价值体现已经足够；同时应用场景千千万，没有什么一方通行的方法，例如居中定位准则，有时候，可能就是需要非居中定位。</p><p>&emsp;&emsp;但是，作为一个有技术追求的技术从业人员，对技术的精益求精一定是有价值的，无论是对自己，还是公司。有人可能会反驳，我们这个项目明明只会针对移动端，你还花心思考虑低配的事情，岂不是白白浪费时间和人力成本。古人有云：“不以善小而不为”，这种去粗取精的小经验虽然看上去没什么实质性成长，对眼前项目也没多少价值体现，但是积累足够多，会产生质变的，填坑的事情少了，工作也更轻松与快乐，对公司产生的价值也更大。</p><p>&emsp;&emsp;高瞻远瞩积跬步，登峰造极至千里。</p><p>&emsp;&emsp;好了，以上就是自己对于多屏CSS动画方面的一些技巧体会，希望可以对大家的学习有所帮助。当然，资历有限，要是文中有什么表述不准确的地方，欢迎指正；也欢迎针锋相对的讨论，共同成长。</p></div><div><div style="padding:10px 0;margin:20px auto;width:94%;text-align:center"><div></div><button id="rewardButton" disable="enable" onclick='var e=document.getElementById("QR");"none"===e.style.display?e.style.display="block":e.style.display="none"'><span>打赏一个泡泡糖</span></button><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"><img id="wechat_qr" src="/uploads/wechatpay.jpg" alt="baosheng WeChat Pay"><p>微信</p></div><div id="alipay" style="display:inline-block"><img id="alipay_qr" src="/uploads/alipay.jpg" alt="baosheng Alipay"><p>支付宝</p></div></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/多屏复杂动画/" rel="tag"># 多屏复杂动画</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2015/07/15/inline-block-justify实现列表两端对齐/" rel="next" title="inline-block + justify实现列表两端对齐"><i class="fa fa-chevron-left"></i> inline-block + justify实现列表两端对齐</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2015/07/15/使用meta实现页面的定时刷新或跳转/" rel="prev" title="使用meta实现页面的定时刷新或跳转">使用meta实现页面的定时刷新或跳转 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div><div class="comments" id="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zMDA4OC82NjQz"></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview">站点概览</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/uploads/avatar.jpg" alt="baosheng"><p class="site-author-name" itemprop="name">baosheng</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">513</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">9</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">805</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-globe"></i> 友情链接</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="http://www.npm8.com/" title="申请友情链接加QQ：347675731" target="_blank">申请友情链接加QQ：347675731</a></li></ul></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#技巧一、使用animation-play-state控制每屏动画播放"><span class="nav-number">1.</span> <span class="nav-text">技巧一、使用animation-play-state控制每屏动画播放</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#技巧二、不同状态下的连续动画"><span class="nav-number">2.</span> <span class="nav-text">技巧二、不同状态下的连续动画</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#技巧三、无侵入定位和居中定位准则"><span class="nav-number">3.</span> <span class="nav-text">技巧三、无侵入定位和居中定位准则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#结语"><span class="nav-number">4.</span> <span class="nav-text">结语</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; 2014 - <span itemprop="copyrightYear">2018</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">baosheng</span><script language="javascript" type="text/javascript" src="//js.users.51.la/19323703.js"></script><noscript><a href="//www.51.la/?19323703" target="_blank"><img alt="&#x6211;&#x8981;&#x5566;&#x514D;&#x8D39;&#x7EDF;&#x8BA1;" src="//img.users.51.la/19323703.asp" style="border:none"></a></noscript></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script><script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script><script type="text/javascript">!function(e,t){var n,c=e.getElementsByTagName(t)[0];"function"!=typeof LivereTower&&(n=e.createElement(t),n.src="https://cdn-city.livere.com/js/embed.dist.js",n.async=!0,c.parentNode.insertBefore(n,c))}(document,"script")</script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(t,e,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,r=document.getElementById(e),s=document.getElementById(o),a=function(){var t=r.value.trim().toLowerCase(),e=t.split(/[\s\-]+/);e.length>1&&e.push(t);var o=[];if(t.length>0&&n.forEach(function(n){function r(e,o,n,r){for(var s=r[r.length-1],a=s.position,i=s.word,l=[],h=0;a+i.length<=n&&0!=r.length;){i===t&&h++,l.push({position:a,length:i.length});var p=a+i.length;for(r.pop();0!=r.length&&(s=r[r.length-1],a=s.position,i=s.word,p>a);)r.pop()}return c+=h,{hits:l,start:o,end:n,searchTextCount:h}}function s(t,e){var o="",n=e.start;return e.hits.forEach(function(e){o+=t.substring(n,e.position);var r=e.position+e.length;o+='<b class="search-keyword">'+t.substring(e.position,r)+"</b>",n=r}),o+=t.substring(n,e.end)}var a=!1,i=0,c=0,l=n.title.trim(),h=l.toLowerCase(),p=n.content.trim().replace(/<[^>]+>/g,""),u=p.toLowerCase(),f=decodeURIComponent(n.url),d=[],g=[];if(""!=l&&(e.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());(s=e.indexOf(t,r))>-1;)a.push({position:s,word:t}),r=s+n;return a}d=d.concat(e(t,h,!1)),g=g.concat(e(t,u,!1))}),(d.length>0||g.length>0)&&(a=!0,i=d.length+g.length)),a){[d,g].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});var v=[];0!=d.length&&v.push(r(l,0,l.length,d));for(var $=[];0!=g.length;){var C=g[g.length-1],m=C.position,x=C.word,w=m-20,y=m+80;w<0&&(w=0),y<m+x.length&&(y=m+x.length),y>p.length&&(y=p.length),$.push(r(p,w,y,g))}$.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var T=parseInt("1");T>=0&&($=$.slice(0,T));var b="";b+=0!=v.length?"<li><a href='"+f+"' class='search-result-title'>"+s(l,v[0])+"</a>":"<li><a href='"+f+"' class='search-result-title'>"+l+"</a>",$.forEach(function(t){b+="<a href='"+f+'\'><p class="search-result">'+s(p,t)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:c,hitCount:i,id:o.length})}}),1===e.length&&""===e[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{o.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var a='<ul class="search-result-list">';o.forEach(function(t){a+=t.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),isfetched===!1?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){var e=27===t.which&&$(".search-popup").is(":visible");e&&onPopupClose()})</script><script>!function(){var t=document.createElement("script"),s=window.location.protocol.split(":")[0];"https"===s?t.src="https://zz.bdstatic.com/linksubmit/push.js":t.src="http://push.zhanzhang.baidu.com/push.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()</script></body></html><!-- rebuild by neat -->